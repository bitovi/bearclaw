import{a as K,b as B,c as x}from"/build/_shared/chunk-HMOOBWRV.js";import{a as U}from"/build/_shared/chunk-L4YW7AOU.js";import{a as P}from"/build/_shared/chunk-BSL3N5K3.js";import{a as w}from"/build/_shared/chunk-QCIUOCWQ.js";import"/build/_shared/chunk-FPCZUKCW.js";import"/build/_shared/chunk-EZ5BYJGA.js";import"/build/_shared/chunk-43WRZGA6.js";import"/build/_shared/chunk-TQRC56TV.js";import"/build/_shared/chunk-BPUBDSZ4.js";import"/build/_shared/chunk-6CKUMXI6.js";import"/build/_shared/chunk-T25WUX7R.js";import{a as c}from"/build/_shared/chunk-AJKPLCOI.js";import"/build/_shared/chunk-5T3E4OPG.js";import"/build/_shared/chunk-MLPEZQPG.js";import{b as I,e as g,m as p}from"/build/_shared/chunk-BT47YPGH.js";import{a as F,b as v}from"/build/_shared/chunk-5HKR6QTR.js";import{d as n}from"/build/_shared/chunk-G5WX4PPA.js";var t=n(K());var d=n(U());var m=n(F());var r=n(v());function Y(){let e=p(),[i,s]=(0,m.useState)(!1),[l,_]=(0,m.useState)(!1),[f,b]=(0,m.useState)(""),u=(0,t.useElements)(),y=(0,t.useStripe)();if("error"in e)return null;let{paymentAccountId:S,clientSecret:h,paymentIntentId:A,subscriptionId:C,priceId:R}=e;return(0,r.jsxs)(c,{display:"flex",flexDirection:"column",justifyContent:"center",children:[l&&(0,r.jsx)(c,{component:"h1",paddingBottom:"4px",marginTop:0,textAlign:"center",children:"Subscribe"}),f&&(0,r.jsx)(c,{children:f}),(0,r.jsxs)(g,{onSubmit:async T=>{if(T.preventDefault(),s(!0),b(""),u&&y&&S)try{if(await x(S))throw new Error("User already has an active subscription");let{error:a}=await u.submit();if(a)throw new Error(a.message);let{error:E}=await y.confirmPayment({elements:u,clientSecret:h,confirmParams:{return_url:`${window.location.origin}/subscription/pay/success?subscription_id=${C}&payment_intent=${A}&planId=${R}`}});if(E)throw new Error(E.message)}catch(o){console.error(o);let a=typeof o=="string"?o:typeof o.message=="string"?o.message:"An error occured processing the Subscription payment";b(a)}finally{s(!1)}},children:[(0,r.jsx)(t.PaymentElement,{onReady:()=>_(!0),options:{layout:"accordion"}}),l&&(0,r.jsx)(w,{type:"submit",name:"submit-payment",variant:"contained",color:"primary",disabled:i,sx:{marginY:4},children:i?(0,r.jsx)(P,{}):"Subscribe"})]})]})}function L(){let e=p(),i=I();if("error"in e)return i("/subscription/overview");let s=B(e.STRIPE_PUBLIC_KEY);return(0,r.jsx)(t.Elements,{stripe:s,options:{clientSecret:e.clientSecret},children:(0,r.jsx)(Y,{})})}export{L as default};
